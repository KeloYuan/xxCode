/**
 * æ¬¢è¿Žé¡µé¢ç»„ä»¶
 * æ— æ–‡ä»¶æ‰“å¼€æ—¶æ˜¾ç¤ºçš„å¼•å¯¼ç•Œé¢
 */
import { ThemeColors } from '../../models/EditorModels'
import { curves } from '@kit.ArkUI'

@Component
export struct WelcomeView {
  @Prop colors: ThemeColors

  onOpenFile: () => void = () => {}
  onOpenFolder: () => void = () => {}
  onNewFile: () => void = () => {}

  // åŠ¨ç”»çŠ¶æ€
  @State logoScale: number = 0.8
  @State logoOpacity: number = 0
  @State contentOffset: number = 30
  @State contentOpacity: number = 0

  aboutToAppear() {
    // å…¥åœºåŠ¨ç”» - ä½¿ç”¨å»¶è¿Ÿå’Œç›´æŽ¥èµ‹å€¼è§¦å‘åŠ¨ç”»
    setTimeout(() => {
      this.logoScale = 1
      this.logoOpacity = 1
    }, 100)

    setTimeout(() => {
      this.contentOffset = 0
      this.contentOpacity = 1
    }, 250)
  }

  build() {
    Stack() {
      // æ¸å˜èƒŒæ™¯è£…é¥°
      Column()
        .width('100%')
        .height('100%')
        .linearGradient({
          angle: 135,
          colors: [
            [this.colors.editorBg, 0.0],
            [this.colors.primary + '08', 0.5],
            [this.colors.editorBg, 1.0]
          ]
        })

      Column({ space: 24 }) {
        Blank().layoutWeight(1)

        // Logo å¸¦å…‰æ™•æ•ˆæžœ
        Column({ space: 12 }) {
          Stack() {
            // å…‰æ™•
            Circle()
              .width(100)
              .height(100)
              .fill(this.colors.primary + '20')
              .blur(30)

            Text('âŒ˜')
              .fontSize(64)
              .fontWeight(FontWeight.Bold)
              .fontColor(this.colors.primary)
          }

          Text('xxCode')
            .fontSize(28)
            .fontWeight(FontWeight.Bold)
            .fontColor(this.colors.textPrimary)
            .letterSpacing(1)

          Text('ä¸“ä¸šçš„é¸¿è’™åŽŸç”Ÿä»£ç ç¼–è¾‘å™¨')
            .fontSize(14)
            .fontColor(this.colors.textSecondary)
        }
        .scale({ x: this.logoScale, y: this.logoScale })
        .opacity(this.logoOpacity)
        .animation({
          duration: 600,
          curve: curves.springMotion(0.5, 0.8)
        })

        // ç‰¹æ€§å¡ç‰‡
        Row({ space: 12 }) {
          this.FeatureCard('âš¡', 'æžé€Ÿå¯åŠ¨')
          this.FeatureCard('ðŸŽ¨', 'ç²¾ç¾Žä¸»é¢˜')
          this.FeatureCard('ðŸ“', 'è¯­æ³•é«˜äº®')
        }
        .width('100%')
        .constraintSize({ maxWidth: 400 })
        .padding({ left: 24, right: 24 })
        .opacity(this.contentOpacity)
        .animation({
          duration: 500,
          curve: curves.springMotion(0.6, 0.9)
        })

      // å¿«æ·æ“ä½œ
      Column({ space: 12 }) {
        this.QuickAction('ðŸ“„', 'æ–°å»ºæ–‡ä»¶', 'åˆ›å»ºä¸€ä¸ªç©ºç™½æ–‡ä»¶', () => this.onNewFile())
        this.QuickAction('ðŸ“‚', 'æ‰“å¼€æ–‡ä»¶', 'æ‰“å¼€æœ¬åœ°æ–‡ä»¶è¿›è¡Œç¼–è¾‘', () => this.onOpenFile())
        this.QuickAction('ðŸ—‚ï¸', 'æ‰“å¼€æ–‡ä»¶å¤¹', 'æ‰“å¼€é¡¹ç›®ç›®å½•', () => this.onOpenFolder())
      }
      .width('100%')
      .constraintSize({ maxWidth: 360 })
      .padding({ left: 24, right: 24 })
      .translate({ y: this.contentOffset })
      .opacity(this.contentOpacity)
      .animation({
        duration: 500,
        curve: curves.springMotion(0.6, 0.9)
      })

      // å¿«æ·é”®æç¤º
      Column({ space: 8 }) {
        Text('å¿«æ·é”®')
          .fontSize(12)
          .fontColor(this.colors.textDisabled)
          .margin({ bottom: 4 })

        Row({ space: 24 }) {
          this.ShortcutItem('Ctrl+O', 'æ‰“å¼€')
          this.ShortcutItem('Ctrl+S', 'ä¿å­˜')
          this.ShortcutItem('Ctrl+N', 'æ–°å»º')
        }
      }
      .translate({ y: this.contentOffset })
      .opacity(this.contentOpacity)
      .margin({ top: 24 })
      .animation({
        duration: 500,
        curve: curves.springMotion(0.6, 0.9)
      })

      Blank().layoutWeight(1)

      // ç‰ˆæœ¬å’Œé“¾æŽ¥
      Row({ space: 16 }) {
        Text('v1.0.0')
          .fontSize(11)
          .fontColor(this.colors.textDisabled)

        Text('â€¢')
          .fontSize(11)
          .fontColor(this.colors.textDisabled)

        Text('GitHub')
          .fontSize(11)
          .fontColor(this.colors.primary)
          .decoration({ type: TextDecorationType.Underline })

        Text('â€¢')
          .fontSize(11)
          .fontColor(this.colors.textDisabled)

        Text('æ–‡æ¡£')
          .fontSize(11)
          .fontColor(this.colors.primary)
          .decoration({ type: TextDecorationType.Underline })
      }
      .margin({ bottom: 24 })
      .opacity(this.contentOpacity)
      }
    }
    .width('100%')
    .height('100%')
  }

  @Builder
  FeatureCard(icon: string, label: string) {
    Column({ space: 6 }) {
      Text(icon)
        .fontSize(28)

      Text(label)
        .fontSize(12)
        .fontColor(this.colors.textSecondary)
    }
    .layoutWeight(1)
    .height(80)
    .borderRadius(12)
    .backgroundColor(this.colors.surface)
    .justifyContent(FlexAlign.Center)
    .shadow({
      radius: 8,
      color: 'rgba(0, 0, 0, 0.04)',
      offsetY: 2
    })
  }

  @Builder
  QuickAction(icon: string, title: string, desc: string, onClick: () => void) {
    Row() {
      // å›¾æ ‡
      Column() {
        Text(icon)
          .fontSize(24)
      }
      .width(48)
      .height(48)
      .borderRadius(12)
      .backgroundColor(this.colors.surfaceVariant)
      .justifyContent(FlexAlign.Center)
      .alignItems(HorizontalAlign.Center)

      // æ–‡å­—
      Column({ space: 2 }) {
        Text(title)
          .fontSize(15)
          .fontWeight(FontWeight.Medium)
          .fontColor(this.colors.textPrimary)

        Text(desc)
          .fontSize(12)
          .fontColor(this.colors.textSecondary)
      }
      .alignItems(HorizontalAlign.Start)
      .margin({ left: 14 })
      .layoutWeight(1)

      // ç®­å¤´
      Text('â€º')
        .fontSize(20)
        .fontColor(this.colors.textDisabled)
    }
    .width('100%')
    .height(68)
    .padding({ left: 12, right: 16 })
    .borderRadius(16)
    .backgroundColor(this.colors.surface)
    .shadow({
      radius: 8,
      color: 'rgba(0, 0, 0, 0.04)',
      offsetY: 2
    })
    .onClick(() => onClick())
  }

  @Builder
  ShortcutItem(key: string, action: string) {
    Row({ space: 6 }) {
      Text(key)
        .fontSize(11)
        .fontColor(this.colors.textSecondary)
        .padding({ left: 6, right: 6, top: 2, bottom: 2 })
        .borderRadius(4)
        .backgroundColor(this.colors.surfaceVariant)

      Text(action)
        .fontSize(11)
        .fontColor(this.colors.textDisabled)
    }
  }
}
