/**
 * Áä∂ÊÄÅÊ†èÁªÑ‰ª∂
 * ÊòæÁ§∫ÂÖâÊ†á‰ΩçÁΩÆ„ÄÅËØ≠Ë®ÄÁ±ªÂûã„ÄÅÁºñÁ†ÅÁ≠â‰ø°ÊÅØ
 */
import { ThemeColors } from '../../models/EditorModels'
import { curves } from '@kit.ArkUI'

@Component
export struct EditorStatusBar {
  @Prop line: number = 1
  @Prop column: number = 1
  @Prop language: string = 'Plain Text'
  @Prop encoding: string = 'UTF-8'
  @Prop lineEnding: string = 'LF'
  @Prop isDirty: boolean = false
  @Prop colors: ThemeColors

  @State languageBtnHover: boolean = false
  @State encodingBtnHover: boolean = false
  @State lineEndingHover: boolean = false
  @State cursorInfoHover: boolean = false

  build() {
    Row() {
      // Â∑¶‰æß‰ø°ÊÅØ
      Row({ space: 12 }) {
        // ÂÖâÊ†á‰ΩçÁΩÆ - Â¢ûÂº∫Áâà
        Row({ space: 6 }) {
          Text('üìç')
            .fontSize(12)
          Text(`Ë°å ${this.line}, Âàó ${this.column}`)
            .fontSize(12)
            .fontColor(this.colors.textPrimary)
            .fontWeight(FontWeight.Medium)
        }
        .padding({ left: 8, right: 8, top: 3, bottom: 3 })
        .borderRadius(6)
        .backgroundColor(this.cursorInfoHover ? this.colors.primary + '20' : this.colors.primary + '10')
        .animation({
          duration: 200,
          curve: curves.springMotion()
        })
        .onHover((isHover: boolean) => {
          this.cursorInfoHover = isHover
        })

        // ÂàÜÈöîÁ¨¶
        Text('‚Ä¢')
          .fontSize(12)
          .fontColor(this.colors.textDisabled)
      }

      Blank()

      // Âè≥‰æß‰ø°ÊÅØ
      Row({ space: 8 }) {
        // ÁºñÁ†ÅÊ†ºÂºè
        this.EnhancedStatusItem('üìù', this.encoding, this.encodingBtnHover, (hover) => {
          this.encodingBtnHover = hover
        })

        // Êç¢Ë°åÁ¨¶
        this.EnhancedStatusItem('‚Ü©Ô∏è', this.lineEnding, this.lineEndingHover, (hover) => {
          this.lineEndingHover = hover
        })

        // ËØ≠Ë®ÄÁ±ªÂûã
        Row({ space: 6 }) {
          Text('üî§')
            .fontSize(12)
          Text(this.getLanguageDisplayName())
            .fontSize(12)
            .fontColor(this.colors.primary)
            .fontWeight(FontWeight.Medium)
        }
        .padding({ left: 8, right: 8, top: 3, bottom: 3 })
        .borderRadius(6)
        .backgroundColor(this.languageBtnHover ? this.colors.primary + '25' : this.colors.primary + '10')
        .animation({
          duration: 200,
          curve: curves.springMotion()
        })
        .onHover((isHover: boolean) => {
          this.languageBtnHover = isHover
        })

        // ÂàÜÈöîÁ¨¶
        if (this.isDirty) {
          Text('‚Ä¢')
            .fontSize(12)
            .fontColor(this.colors.textDisabled)
        }

        // ‰øùÂ≠òÁä∂ÊÄÅÂ¢ûÂº∫
        if (this.isDirty) {
          Row({ space: 4 }) {
            Text('‚óè')
              .fontSize(10)
              .fontColor('#FF3B30')
            Text('Êú™‰øùÂ≠ò')
              .fontSize(11)
              .fontColor('#FF3B30')
              .fontWeight(FontWeight.Medium)
          }
          .padding({ left: 8, right: 8, top: 3, bottom: 3 })
          .borderRadius(6)
          .backgroundColor('#FF3B3015')
        } else {
          Text('‚úì')
            .fontSize(14)
            .fontColor('#34C759')
        }
      }
    }
    .width('100%')
    .height(28)
    .padding({ left: 16, right: 16 })
    .backgroundColor(this.colors.surfaceVariant)
    .border({
      width: { top: 1 },
      color: this.colors.divider
    })
  }

  @Builder
  StatusItem(text: string) {
    Text(text)
      .fontSize(12)
      .fontColor(this.colors.textSecondary)
  }

  @Builder
  EnhancedStatusItem(icon: string, text: string, isHovered: boolean, onHoverChange: (hover: boolean) => void) {
    Row({ space: 4 }) {
      Text(icon)
        .fontSize(12)
      Text(text)
        .fontSize(12)
        .fontColor(this.colors.textSecondary)
    }
    .padding({ left: 8, right: 8, top: 3, bottom: 3 })
    .borderRadius(6)
    .backgroundColor(isHovered ? this.colors.hover : Color.Transparent)
    .animation({
      duration: 200,
      curve: curves.springMotion()
    })
    .onHover((isHover: boolean) => {
      onHoverChange(isHover)
    })
  }

  @Builder
  ClickableStatusItem(text: string, isHovered: boolean, onHoverChange: (hover: boolean) => void) {
    Text(text)
      .fontSize(12)
      .fontColor(this.colors.textSecondary)
      .padding({ left: 8, right: 8, top: 2, bottom: 2 })
      .borderRadius(4)
      .backgroundColor(isHovered ? this.colors.hover : Color.Transparent)
      .animation({
        duration: 150,
        curve: Curve.EaseOut
      })
      .onHover((isHover: boolean) => {
        onHoverChange(isHover)
      })
  }

  @Builder
  DirtyIndicator() {
    Row({ space: 6 }) {
      Circle()
        .width(6)
        .height(6)
        .fill('#F59E0B')

      Text('Êú™‰øùÂ≠ò')
        .fontSize(12)
        .fontColor('#F59E0B')
    }
    .padding({ left: 8, right: 8 })
    .height(22)
    .borderRadius(4)
    .backgroundColor('rgba(245, 158, 11, 0.1)')
  }

  private getLanguageDisplayName(): string {
    const nameMap: Record<string, string> = {
      'arkts': 'ArkTS',
      'typescript': 'TypeScript',
      'javascript': 'JavaScript',
      'json': 'JSON',
      'markdown': 'Markdown',
      'html': 'HTML',
      'css': 'CSS',
      'python': 'Python',
      'java': 'Java',
      'text': 'Plain Text'
    }
    return nameMap[this.language.toLowerCase()] || this.language
  }
}
